# virtual

## 哪些函数不能是虚函数

### 内联函数不能是 virtual

内联函数是在编译时期展开，而虚函数的特性是运行时才动态联编,所以两者矛盾，不能定义内联函数为虚函数。

虚表机制需要一个真正的函数地址，而内联函数展开以后，就不是一个函数，而是一段简单的代码。

### 构造函数不能是 virtual

尽管虚函数表 `vtable` 是在编译阶段就已经建立的，但指向虚函数表的指针 `vptr` 是在运行阶段实例化对象时才产生的。 如果类含有虚函数，编译器会在构造函数中添加代码来创建 `vptr`。 问题来了，如果构造函数是虚的，那么它需要 `vptr` 来访问 `vtable`，可这个时候 `vptr` 还没产生。 因此，构造函数不可以为虚函数。

我们之所以使用虚函数，是因为需要在信息不全的情况下进行多态运行。而构造函数是用来初始化实例的，实例的类型必须是明确的。 因此，构造函数没有必要被声明为虚函数。

### 静态成员函数不能是 virtual

虚函数依靠 `vptr` 和 `vtable` 来处理。`vptr` 是一个指针，在类的构造函数中创建生成，并且只能用 `this` 指针来访问它，静态成员函数没有this指针，所以无法访问 `vptr`。

### 友元函数

因为`C++`不支持友元函数的继承，对于没有继承特性的函数没有虚函数的说法。